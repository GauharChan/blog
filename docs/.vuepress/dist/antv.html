<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>antv/x6 | gauhar&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="just a blog">
    
    <link rel="preload" href="/assets/css/0.styles.869cdc64.css" as="style"><link rel="preload" href="/assets/js/app.46b248ef.js" as="script"><link rel="preload" href="/assets/js/2.b3b6b608.js" as="script"><link rel="preload" href="/assets/js/8.037b443b.js" as="script"><link rel="prefetch" href="/assets/js/10.324894d8.js"><link rel="prefetch" href="/assets/js/11.62d9a39b.js"><link rel="prefetch" href="/assets/js/12.b4b9cd73.js"><link rel="prefetch" href="/assets/js/13.f23fe0f2.js"><link rel="prefetch" href="/assets/js/14.ac904cad.js"><link rel="prefetch" href="/assets/js/15.49896867.js"><link rel="prefetch" href="/assets/js/16.2cfa9c26.js"><link rel="prefetch" href="/assets/js/17.e2f574b1.js"><link rel="prefetch" href="/assets/js/18.e65813c7.js"><link rel="prefetch" href="/assets/js/19.b9883cae.js"><link rel="prefetch" href="/assets/js/20.f727ff3e.js"><link rel="prefetch" href="/assets/js/21.816f9fb6.js"><link rel="prefetch" href="/assets/js/22.1b1a97cf.js"><link rel="prefetch" href="/assets/js/23.3497f7e6.js"><link rel="prefetch" href="/assets/js/24.d17c77f2.js"><link rel="prefetch" href="/assets/js/25.23ff15d8.js"><link rel="prefetch" href="/assets/js/26.aeb4f3f6.js"><link rel="prefetch" href="/assets/js/27.414db626.js"><link rel="prefetch" href="/assets/js/28.d2c3122b.js"><link rel="prefetch" href="/assets/js/3.5df4b9fb.js"><link rel="prefetch" href="/assets/js/4.04ea9ddc.js"><link rel="prefetch" href="/assets/js/5.81f72305.js"><link rel="prefetch" href="/assets/js/6.5e142bca.js"><link rel="prefetch" href="/assets/js/7.f59eda33.js"><link rel="prefetch" href="/assets/js/9.e6f22c9b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.869cdc64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">gauhar's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://gauhar.gitee.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hexo版博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/gauhar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/GauharChan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://gauhar.gitee.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hexo版博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/gauhar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/GauharChan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vue3.html" class="sidebar-link">vue3</a></li><li><a href="/antv.html" aria-current="page" class="active sidebar-link">antv</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/antv.html#antv-x6" class="sidebar-link">antv/x6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/antv.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/antv.html#_1-创建画布" class="sidebar-link">1.创建画布</a></li><li class="sidebar-sub-header"><a href="/antv.html#_2-注册节点" class="sidebar-link">2.注册节点</a></li><li class="sidebar-sub-header"><a href="/antv.html#_3-生成节点" class="sidebar-link">3.生成节点</a></li><li class="sidebar-sub-header"><a href="/antv.html#_4-两个节点之间连线-创建边" class="sidebar-link">4.两个节点之间连线(创建边)</a></li><li class="sidebar-sub-header"><a href="/antv.html#_5-选择连接线-并监听键盘删除键进行删除" class="sidebar-link">5.选择连接线，并监听键盘删除键进行删除</a></li></ul></li><li class="sidebar-sub-header"><a href="/antv.html#l7" class="sidebar-link">L7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/antv.html#cdn" class="sidebar-link">cdn</a></li><li class="sidebar-sub-header"><a href="/antv.html#创建scene场景" class="sidebar-link">创建Scene场景</a></li><li class="sidebar-sub-header"><a href="/antv.html#基础地图" class="sidebar-link">基础地图</a></li><li class="sidebar-sub-header"><a href="/antv.html#创建中国地图" class="sidebar-link">创建中国地图</a></li><li class="sidebar-sub-header"><a href="/antv.html#钻地地图" class="sidebar-link">钻地地图</a></li><li class="sidebar-sub-header"><a href="/antv.html#中国地图两地连线" class="sidebar-link">中国地图两地连线</a></li><li class="sidebar-sub-header"><a href="/antv.html#双曲线" class="sidebar-link">双曲线</a></li></ul></li><li class="sidebar-sub-header"><a href="/antv.html#生成随机数的数组" class="sidebar-link">生成随机数的数组</a></li></ul></li><li><a href="/typeScript.html" class="sidebar-link">typeScript</a></li><li><a href="/uniapp.html" class="sidebar-link">uniapp</a></li><li><a href="/es6笔记.html" class="sidebar-link">es6笔记</a></li><li><a href="/问题.html" class="sidebar-link">问题</a></li><li><a href="/js学习笔记.html" class="sidebar-link">js学习笔记</a></li><li><a href="/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/vue笔记.html" class="sidebar-link">vue笔记</a></li><li><a href="/常用代码.html" class="sidebar-link">常用代码</a></li><li><a href="/工作常用代码.html" class="sidebar-link">工作常用代码</a></li><li><a href="/工作上遇到的坑.html" class="sidebar-link">工作上遇到的坑</a></li><li><a href="/那些坑.html" class="sidebar-link">那些坑</a></li><li><a href="/正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/flutter.html" class="sidebar-link">flutter</a></li><li><a href="/js笔记.html" class="sidebar-link">js笔记</a></li><li><a href="/note.html" class="sidebar-link">note</a></li><li><a href="/git托管代码.html" class="sidebar-link">git托管代码</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="antv-x6"><a href="#antv-x6" class="header-anchor">#</a> antv/x6</h2> <blockquote><p>用于实现流程图，可进行交互。本文记录的是<code>vue</code>的用法。</p></blockquote> <p><a href="https://codesandbox.io/s/x6-demo-ffwso" target="_blank" rel="noopener noreferrer">完整的demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <iframe src="https://codesandbox.io/embed/x6-demo-ffwso?codemirror=1" allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden;"></iframe> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <blockquote><p>建议使用<code>yarn</code>安装哈，一开始我也是贪<code>cnpm</code>速度快一点，结果安装不了<code>x6-vue-shape</code></p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># yarn</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> @antv/x6

<span class="token comment"># yarn</span>
<span class="token function">yarn</span> <span class="token function">add</span> @antv/x6-vue-shape

<span class="token comment"># 在 vue2 下还需要安装 @vue/composition-api</span>
<span class="token function">yarn</span> <span class="token function">add</span> @vue/composition-api --dev
</code></pre></div><h3 id="_1-创建画布"><a href="#_1-创建画布" class="header-anchor">#</a> 1.创建画布</h3> <ul><li><code>keyboard</code>开启监听键盘</li> <li><code>selecting</code>设置选择节点，可通过<code>filter</code>去过滤。我只需要选择连接线(x6中叫边<code>Edge</code>)。<code>graph.isEdge(node)</code>判断传入的节点是否为边(Edge)</li> <li><code>scroller</code>使用<code>scroller</code>模式，超出<code>container</code>会出现滚动条可移动查看节点<code>node</code>,<code>pannable</code>是否启用画布平移能力</li> <li><code>translating</code>配置移动选项，我这里限制了子组件不可以拖动，限制在父组件里面，只能移动父组件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'@antv/x6-vue-shape'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Graph<span class="token punctuation">,</span> Line<span class="token punctuation">,</span> Path<span class="token punctuation">,</span> Curve<span class="token punctuation">,</span> Addon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@antv/x6'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      graph<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建画布</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  container<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'drag-container'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  keyboard<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  scroller<span class="token operator">:</span> <span class="token punctuation">{</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    pannable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  selecting<span class="token operator">:</span> <span class="token punctuation">{</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    rubberband<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function">filter</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 只选连接线(边)</span>
      <span class="token keyword">return</span> that<span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">isEdge</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  translating<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">restrict</span> <span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> cell <span class="token operator">=</span> view<span class="token punctuation">.</span>cell
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token function">isNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> parent <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 限制子节点不能移动</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            x<span class="token operator">:</span> cell<span class="token punctuation">.</span><span class="token function">getBBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
            y<span class="token operator">:</span> cell<span class="token punctuation">.</span><span class="token function">getBBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
            width<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            height<span class="token operator">:</span> <span class="token number">0</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-注册节点"><a href="#_2-注册节点" class="header-anchor">#</a> 2.注册节点</h3> <p>我的节点都是用vue组件写的，并不是用原生svg的一些图形(circle、rect)，实际开发的需求肯定不是这么简单，vue组件必须用<code>registerVueComponent</code>注册，否则后面做回显时，使用不了<code>toJSON</code>和<code>fromJSON</code>。回显时使用这两个api，不需要任何的操作，渲染即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Drag <span class="token keyword">from</span> <span class="token string">'@/components/drag/drag.vue'</span>
<span class="token keyword">import</span> Item <span class="token keyword">from</span> <span class="token string">'@/components/drag/item.vue'</span>

<span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token comment">// 注册父组件</span>
Graph<span class="token punctuation">.</span><span class="token function">registerVueComponent</span><span class="token punctuation">(</span>
  <span class="token string">'Drag'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    template<span class="token operator">:</span> <span class="token string">'&lt;drag @parentnoderemove=&quot;parentnoderemove&quot;&gt;&lt;/drag&gt;'</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">parentnoderemove</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 删除对应的节点</span>
        that<span class="token punctuation">.</span>saveNodes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>saveNodes<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span>
      Drag
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
<span class="token comment">// 注册子组件</span>
Graph<span class="token punctuation">.</span><span class="token function">registerVueComponent</span><span class="token punctuation">(</span>
  <span class="token string">'Item'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    template<span class="token operator">:</span> <span class="token string">'&lt;item @edge=&quot;edge&quot;&gt;&lt;/item&gt;'</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 两个节点之间连线</span>
      edge<span class="token operator">:</span> that<span class="token punctuation">.</span>edge
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span>
      Item
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-生成节点"><a href="#_3-生成节点" class="header-anchor">#</a> 3.生成节点</h3> <p>我这里用到了拖拽生成节点，对于拖拽，<code>x6</code>提供了<code>Dnd</code>。首先对<code>Dnd</code>进行创建配置</p> <p><code>getDropNode</code>配置拖拽结束，创建节点之前执行的函数，这个函数一定要<code>return node</code>节点</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 拖拽</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dnd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Addon<span class="token punctuation">.</span>Dnd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">,</span> <span class="token comment">// 画布对象</span>
  scaled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  animation<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  getDropNode<span class="token operator">:</span> that<span class="token punctuation">.</span>handleEndDrag
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>对开始拖拽的目标节点<code>&lt;div&gt;</code>添加<code>mousedown</code>事件去执行<code>Dnd.start</code>事件即可，start函数要传入<code>mousedown</code>事件的<code>event</code>对象</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>side-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>• 统计对象<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
       <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>side-item<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in leftSide<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">@mousedown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleDrag(item, $event)<span class="token punctuation">&quot;</span></span>
     <span class="token punctuation">&gt;</span></span>
      {{item.title}}
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>methods</p> <p>创建节点需要提交x、y坐标值，所以在handleEndDrag事件中我先让返回的父组件渲染完成后，获取父组件的x、y的值，再创建子节点。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 开始拖拽</span>
      <span class="token function">handleDrag</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> e<span class="token punctuation">,</span> weidu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 业务逻辑</span>
        
        <span class="token comment">// item请求。。</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>createChildren <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">// item请求回来的数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleCreateNode</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">handleCreateNode</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token comment">// 创建父节点</span>
        <span class="token keyword">const</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">createNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          shape<span class="token operator">:</span> <span class="token string">'vue-shape'</span><span class="token punctuation">,</span>
          x<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
          y<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
          height<span class="token operator">:</span> that<span class="token punctuation">.</span>createChildren<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token comment">// 根据实际的UI样式来</span>
          data<span class="token operator">:</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">,</span>
            height<span class="token operator">:</span> that<span class="token punctuation">.</span>createChildren<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> <span class="token number">58</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'Drag'</span> <span class="token comment">// 这个名字对应registerVueComponent的名字</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 开始拖拽</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dnd<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 拖拽结束，渲染节点之前，必须返回克隆的节点</span>
      <span class="token function">handleEndDrag</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cloneNode <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span> deep<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token comment">// 父节点渲染之后再执行，因为需要父节点的位置</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> cloneNode<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// 是否第一个节点</span>
          <span class="token keyword">const</span> cellCount <span class="token operator">=</span> that<span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">getCellCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>createChildren<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              shape<span class="token operator">:</span> <span class="token string">'vue-shape'</span><span class="token punctuation">,</span>
              x<span class="token operator">:</span> x <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span>
              y<span class="token operator">:</span> index <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> y <span class="token operator">+</span> <span class="token number">58</span> <span class="token operator">:</span> y <span class="token operator">+</span> <span class="token punctuation">(</span>index <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> <span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              width<span class="token operator">:</span> <span class="token number">240</span><span class="token punctuation">,</span>
              height<span class="token operator">:</span> <span class="token number">46</span><span class="token punctuation">,</span>
              data<span class="token operator">:</span> <span class="token punctuation">{</span>
                item
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              component<span class="token operator">:</span> <span class="token string">'Item'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            cloneNode<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token comment">// 添加到父节点</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>saveNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cloneNode<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>cellCount <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>firstNode <span class="token operator">=</span> cloneNode
            that<span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'第一个统计对象为主体'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> cloneNode
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_4-两个节点之间连线-创建边"><a href="#_4-两个节点之间连线-创建边" class="header-anchor">#</a> 4.两个节点之间连线(创建边)</h3> <p>需求是点击两个node，就让它们连线</p> <p>点击的事件我放在了item组件里，点击后出发父组件这边的edge方法</p> <p><code>connector</code>决定你的线是怎样的，我这边是圆弧</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 连线规则，圆弧</span>
Graph<span class="token punctuation">.</span><span class="token function">registerConnector</span><span class="token punctuation">(</span> <span class="token comment">// Graph不是创建的画布实例(this.graph)!!!</span>
  <span class="token string">'smooth'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>
    <span class="token parameter">sourcePoint<span class="token punctuation">,</span>
    targetPoint<span class="token punctuation">,</span>
    routePoints<span class="token punctuation">,</span>
    options</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Line</span><span class="token punctuation">(</span>sourcePoint<span class="token punctuation">,</span> targetPoint<span class="token punctuation">)</span>
    <span class="token keyword">const</span> diff <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">const</span> factor <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">const</span> vertice <span class="token operator">=</span> line
    <span class="token punctuation">.</span><span class="token function">pointAtLength</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">12</span> <span class="token operator">*</span> factor <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> points <span class="token operator">=</span> <span class="token punctuation">[</span>sourcePoint<span class="token punctuation">,</span> vertice<span class="token punctuation">,</span> targetPoint<span class="token punctuation">]</span>
    <span class="token keyword">const</span> curves <span class="token operator">=</span> Curve<span class="token punctuation">.</span><span class="token function">throughPoints</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>curves<span class="token punctuation">)</span>
    <span class="token keyword">return</span> options<span class="token punctuation">.</span>raw <span class="token operator">?</span> path <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
    
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 两个node之间连线</span>
<span class="token function">edge</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('node', node.id)</span>
  <span class="token comment">// console.log('AllEdges', this.graph.getEdges(node))</span>
  <span class="token keyword">const</span> allEdges <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">getEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 改变active状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'callNodes'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 判断不是同一父级</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_parent<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_parent<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 要连线的目标id和来源id</span>
      <span class="token keyword">const</span> allTargetAndAllSource <span class="token operator">=</span> allEdges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        item<span class="token punctuation">.</span><span class="token function">getTargetCellId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        item<span class="token punctuation">.</span><span class="token function">getSourceCellId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> flag <span class="token operator">=</span> allTargetAndAllSource<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> 
        item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id
      <span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// 如果两个点已经连过线,</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token comment">// 这里通过坐标决定连线的点</span>
      <span class="token keyword">const</span> sourceAnchor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">?</span> <span class="token string">'right'</span> <span class="token operator">:</span> <span class="token string">'left'</span>
      <span class="token keyword">const</span> targetAnchor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">?</span> <span class="token string">'left'</span> <span class="token operator">:</span> <span class="token string">'right'</span>
      <span class="token comment">// 设置箭头的大小</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">{</span>
        size<span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">addEdge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        source<span class="token operator">:</span> <span class="token punctuation">{</span> cell<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> anchor<span class="token operator">:</span> sourceAnchor<span class="token punctuation">,</span> connectionPoint<span class="token operator">:</span> <span class="token string">'anchor'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        target<span class="token operator">:</span> <span class="token punctuation">{</span> cell<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> anchor<span class="token operator">:</span> targetAnchor<span class="token punctuation">,</span> connectionPoint<span class="token operator">:</span> <span class="token string">'anchor'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        connector<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'smooth'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          line<span class="token operator">:</span> <span class="token punctuation">{</span>
            strokeDasharray<span class="token operator">:</span> <span class="token string">'5 5'</span><span class="token punctuation">,</span>
            stroke<span class="token operator">:</span> <span class="token string">'#666'</span><span class="token punctuation">,</span>
            strokeWidth<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            sourceMarker<span class="token operator">:</span> <span class="token punctuation">{</span>
              args<span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">'block'</span> <span class="token comment">// 实心箭头</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            targetMarker<span class="token operator">:</span> <span class="token punctuation">{</span>
              args<span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">'block'</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 无论如何都清空</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>waitEdgeNodes<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_5-选择连接线-并监听键盘删除键进行删除"><a href="#_5-选择连接线-并监听键盘删除键进行删除" class="header-anchor">#</a> 5.选择连接线，并监听键盘删除键进行删除</h3> <p>因为一开始的配置就限制了只能选择edge，所以这里不用判断其他的cell</p> <p>这部分主要是更改样式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 选择连接线(边)事件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'selection:changed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> added<span class="token punctuation">,</span> removed <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>selectLine <span class="token operator">=</span> added
  added<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span>
    cell<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      line<span class="token operator">:</span> <span class="token punctuation">{</span>
        sourceMarker<span class="token operator">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'block'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        targetMarker<span class="token operator">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'block'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        stroke<span class="token operator">:</span> <span class="token string">'#2D8CF0'</span><span class="token punctuation">,</span>
        strokeWidth<span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  removed<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span>
    cell<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      line<span class="token operator">:</span> <span class="token punctuation">{</span>
        sourceMarker<span class="token operator">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'block'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        targetMarker<span class="token operator">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'block'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        stroke<span class="token operator">:</span> <span class="token string">'#666'</span><span class="token punctuation">,</span>
        strokeWidth<span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p><strong>监听删除键删除</strong></p> <p>通过cell.remove方法删除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 删除连接线(边)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>graph<span class="token punctuation">.</span><span class="token function">bindKey</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Backspace'</span><span class="token punctuation">,</span> <span class="token string">'Delete'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectLine<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token string">'确认删除连线吗?'</span><span class="token punctuation">,</span> <span class="token string">'提示'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      confirmButtonText<span class="token operator">:</span> <span class="token string">'确定'</span><span class="token punctuation">,</span>
      cancelButtonText<span class="token operator">:</span> <span class="token string">'取消'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'warning'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
        message<span class="token operator">:</span> <span class="token string">'删除成功!'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
</code></pre></div><h2 id="l7"><a href="#l7" class="header-anchor">#</a> L7</h2> <blockquote><p>地理空间数据可视化(<strong>地图)</strong></p></blockquote> <h3 id="cdn"><a href="#cdn" class="header-anchor">#</a> cdn</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">'</span>https://cdn.jsdelivr.net/npm/@antv/l7@2.2.40/dist/l7.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/@antv/l7-district@2.2.39/dist/l7-district.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在<code>shims-tsx.d.ts</code>文件中声明L7对象</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Vue<span class="token punctuation">,</span> <span class="token punctuation">{</span> VNode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">declare</span> global <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span>
    combineHeader<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">interface</span> <span class="token class-name">Icol</span> <span class="token punctuation">{</span>
    span<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    offset<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token constant">L7</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token comment">// L7地图</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="创建scene场景"><a href="#创建scene场景" class="header-anchor">#</a> 创建Scene场景</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Scene<span class="token punctuation">,</span> District<span class="token punctuation">,</span> LineLayer<span class="token punctuation">,</span> Popup <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">L7</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 渲染容器</span>
  logoVisible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否展示logo</span>
  map<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GaodeMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 使用高德地图</span>
    pitch<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 倾斜角度</span>
    style<span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span> <span class="token comment">// dark light normal blank(无底图)</span>
    zoom<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 默认缩放</span>
    minZoom<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 最小缩放</span>
    maxZoom<span class="token operator">:</span> <span class="token number">4</span> <span class="token comment">// 最大缩放</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基础地图"><a href="#基础地图" class="header-anchor">#</a> 基础地图</h3> <h3 id="创建中国地图"><a href="#创建中国地图" class="header-anchor">#</a> 创建中国地图</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 中国地图</span>
<span class="token keyword">const</span> country <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">District</span><span class="token punctuation">.</span><span class="token function">CountryLayer</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provinceData<span class="token punctuation">,</span> <span class="token comment">// 地图数据(各省的数据)</span>
  joinBy<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;NAME_CHN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 数据关联，L7默认是拿NAME_CHN这个字段渲染数据。而我们this.provinceData(数据)的省份字段名为name。省份名字对应才能拿到数据</span>
  depth<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 0：国家级，1:省级，2: 市级，3：县级</span>
  label<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">&quot;green&quot;</span> <span class="token comment">// 省份名字的字体颜色</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  provinceStroke<span class="token operator">:</span> <span class="token string">&quot;#783D2D&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 省界颜色</span>
  cityStroke<span class="token operator">:</span> <span class="token string">&quot;#EBCCB4&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 城市边界颜色</span>
  cityStrokeWidth<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 城市边界宽度</span>
  fill<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 每个省份板块的填充</span>
    color<span class="token operator">:</span> <span class="token punctuation">{</span>
      field<span class="token operator">:</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token comment">// this.provinceData(数据)中的字段名。就是下面val的值</span>
      <span class="token comment">// 根据provinceData的value值，显示不同的颜色</span>
      <span class="token function-variable function">values</span><span class="token operator">:</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&gt;</span> <span class="token number">20000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token string">&quot;#e6550d&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token number">1477.63</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token string">&quot;#a63603&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token string">&quot;#fdae6b&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    activeColor<span class="token operator">:</span> <span class="token string">&quot;#bfa&quot;</span> <span class="token comment">// 鼠标滑过颜色</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  popup<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 弹窗，触发事件默认鼠标滑过</span>
    enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Html</span><span class="token operator">:</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span><span class="token constant">NAME_CHN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="钻地地图"><a href="#钻地地图" class="header-anchor">#</a> 钻地地图</h3> <h3 id="中国地图两地连线"><a href="#中国地图两地连线" class="header-anchor">#</a> 中国地图两地连线</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">initChinaChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$api<span class="token punctuation">.</span><span class="token function">userStatisticsQueryUserDistributionFetch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getSearchForm<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>provinceData <span class="token operator">=</span> res<span class="token punctuation">.</span>data
  <span class="token keyword">const</span> <span class="token punctuation">{</span> Scene<span class="token punctuation">,</span> District<span class="token punctuation">,</span> LineLayer<span class="token punctuation">,</span> Popup <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">L7</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 渲染容器</span>
    logoVisible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否展示logo</span>
    map<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GaodeMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 使用高德地图</span>
      pitch<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 倾斜角度</span>
      style<span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span> <span class="token comment">// dark light normal blank(无底图)</span>
      zoom<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 默认缩放</span>
      minZoom<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 最小缩放</span>
      maxZoom<span class="token operator">:</span> <span class="token number">4</span> <span class="token comment">// 最大缩放</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;loaded&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 线</span>
    <span class="token keyword">const</span> layer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LineLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      zIndex<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 图层绘制顺序，数值大绘制在上层，可以控制图层绘制的上下层级。不设置会被地图遮住</span>
      blend<span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span>
      popup<span class="token operator">:</span> <span class="token punctuation">{</span>
        enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function-variable function">Html</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span><span class="token constant">NAME_CHN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>jsonData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      parser<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
        x<span class="token operator">:</span> <span class="token string">&quot;lng1&quot;</span><span class="token punctuation">,</span>
        y<span class="token operator">:</span> <span class="token string">&quot;lat1&quot;</span><span class="token punctuation">,</span>
        x1<span class="token operator">:</span> <span class="token string">&quot;lng2&quot;</span><span class="token punctuation">,</span>
        y1<span class="token operator">:</span> <span class="token string">&quot;lat2&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">shape</span><span class="token punctuation">(</span><span class="token string">&quot;arc&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      opacity<span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
      blur<span class="token operator">:</span> <span class="token number">0.99</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// .animate({</span>
    <span class="token comment">//   interval: 0.2,</span>
    <span class="token comment">//   trailLength: 1,</span>
    <span class="token comment">//   duration: 1</span>
    <span class="token comment">// });</span>
    <span class="token comment">// 鼠标移动到线的提示框</span>
    <span class="token keyword">const</span> popup<span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Popup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      offset<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      closeButton<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    layer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 设置 popup 的经纬度位置</span>
      popup
        <span class="token punctuation">.</span><span class="token function">setLnglat</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>lngLat<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setHTML</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>from<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>to<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span><span class="token function">addPopup</span><span class="token punctuation">(</span>popup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    layer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mouseout&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      popup<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 中国地图</span>
    <span class="token keyword">const</span> country <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">District<span class="token punctuation">.</span>CountryLayer</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provinceData<span class="token punctuation">,</span> <span class="token comment">// 地图数据(各省的数据)</span>
      joinBy<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;NAME_CHN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;province_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 数据关联，L7默认是拿NAME_CHN这个字段渲染数据。而我们this.provinceData(数据)的省份字段名为name。省份名字对应才能拿到数据</span>
      depth<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 0：国家级，1:省级，2: 市级，3：县级</span>
      label<span class="token operator">:</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token string">&quot;green&quot;</span> <span class="token comment">// 省份名字的字体颜色</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      provinceStroke<span class="token operator">:</span> <span class="token string">&quot;#783D2D&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 省界颜色</span>
      fill<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 每个省份板块的填充</span>
        color<span class="token operator">:</span> <span class="token punctuation">{</span>
          field<span class="token operator">:</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> <span class="token comment">// this.provinceData(数据)中的字段名。就是下面val的值</span>
          <span class="token comment">// 根据provinceData的value值，显示不同的颜色</span>
          <span class="token function-variable function">values</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token string">&quot;#e6550d&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token string">&quot;#a63603&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token string">&quot;#fdae6b&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        activeColor<span class="token operator">:</span> <span class="token string">&quot;#bfa&quot;</span> <span class="token comment">// 鼠标滑过颜色</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      popup<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 弹窗，触发事件默认鼠标滑过</span>
        enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function-variable function">Html</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span><span class="token constant">NAME_CHN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>num<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="双曲线"><a href="#双曲线" class="header-anchor">#</a> 双曲线</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">initTestChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍎&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;全家&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍎&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;美宜佳&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍌&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;全家&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍌&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;美宜佳&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍇&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;全家&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍇&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;美宜佳&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍐&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;全家&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      key<span class="token operator">:</span> <span class="token string">&quot;🍐&quot;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">&quot;美宜佳&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> chart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chart</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    container<span class="token operator">:</span> <span class="token string">&quot;testChart&quot;</span><span class="token punctuation">,</span>
    height<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    padding<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    autoFit<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token punctuation">{</span>
      min<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      nice<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    position<span class="token operator">:</span> <span class="token string">&quot;bottom&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart
    <span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token string">&quot;key*value&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;#14deff&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">tooltip</span><span class="token punctuation">(</span><span class="token string">&quot;key*value&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token operator">:</span> any<span class="token punctuation">,</span> b<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;自定义&quot;</span> <span class="token operator">+</span> a<span class="token punctuation">,</span>
    value<span class="token operator">:</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart
    <span class="token punctuation">.</span><span class="token function">point</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token string">&quot;key*value&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;#14deff&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fill<span class="token operator">:</span> <span class="token string">&quot;#14deff&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chart<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="生成随机数的数组"><a href="#生成随机数的数组" class="header-anchor">#</a> 生成随机数的数组</h2> <blockquote><p><code>from()</code> 方法用于通过拥有 <code>length</code> 属性的对象或可迭代的对象来返回一个数组。</p> <p><code>~~(Math.random() * 5)</code>生成100个0~5之间的随机数。<code>~~</code>是向下取整的简写语法</p> <p>通过<code>Set</code>去重</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span>length<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token string">'d'</span> <span class="token operator">+</span> item<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue3.html" class="prev">
        vue3
      </a></span> <span class="next"><a href="/typeScript.html">
        typeScript
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.46b248ef.js" defer></script><script src="/assets/js/2.b3b6b608.js" defer></script><script src="/assets/js/8.037b443b.js" defer></script>
  </body>
</html>
